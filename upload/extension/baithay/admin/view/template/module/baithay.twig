{{ header }}
{{ column_left }}

<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="float-end">
        <button type="submit" form="form-module" data-bs-toggle="tooltip" title="Lưu" class="btn btn-primary">
          <i class="fa-solid fa-save"></i>
        </button>
        <a href="{{ back }}" data-bs-toggle="tooltip" title="Quay lại" class="btn btn-light">
          <i class="fa-solid fa-reply"></i>
        </a>
      </div>

      <h1>{{ heading_title }}</h1>
      <ol class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li class="breadcrumb-item">
          <a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a>
        </li>
        {% endfor %}
      </ol>
    </div>
  </div>

  <div class="container-fluid">
    <div class="card">
      <div class="card-header">
        <i class="fa-solid fa-pencil"></i> Edit Module
      </div>

      <div class="card-body">
        <form id="form-module" action="{{ save }}" method="post" data-oc-toggle="ajax">
          
          <!-- Chọn sản phẩm -->
          <div class="row mb-3">
            <label class="col-sm-2 col-form-label">Chọn Sản Phẩm</label>
            <div class="col-sm-10">
              <input type="text"
                id="input-product"
                name="product_name"
                value=""
                placeholder=" Example: mac, iphone "
                class="form-control"
                autocomplete="off"
              />

              <div id="module-product"
                class="form-control"
                style="height: 150px; overflow: auto; margin-top: 5px;">
                {% for product in products %}
                <div id="module-product-{{ product.product_id }}">
                  <i class="fa-solid fa-minus-circle"></i> {{ product.name }}
                  <input type="hidden" name="module_baithay_product[]" value="{{ product.product_id }}" />
                </div>
                {% endfor %}
              </div>

              <div class="form-text"> Wait 1 second</div>
            </div>
          </div>

          <!-- Limit -->
          <div class="row mb-3">
            <label class="col-sm-2 col-form-label">Quantity</label>
            <div class="col-sm-10">
              <input type="text" name="module_baithay_limit" value="{{ module_baithay_limit }}" placeholder="5" class="form-control"/>
            </div>
          </div>

          <!-- Image size -->
          <div class="row mb-3">
            <label class="col-sm-2 col-form-label">Size picture (WxH)</label>
            <div class="col-sm-5">
              <input type="text" name="module_baithay_width" value="{{ module_baithay_width }}" placeholder="Width (200)" class="form-control"/>
            </div>
            <div class="col-sm-5">
              <input type="text" name="module_baithay_height" value="{{ module_baithay_height }}" placeholder="Height (200)" class="form-control"/>
            </div>
          </div>

          <!-- Status -->
          <div class="row mb-3">
            <label class="col-sm-2 col-form-label">Status</label>
            <div class="col-sm-10">
              <div class="form-check form-switch form-switch-lg">
                <input type="hidden" name="module_baithay_status" value="0"/>
                <input type="checkbox" name="module_baithay_status" value="1" class="form-check-input"
                  {% if module_baithay_status %} checked {% endif %}/>
              </div>
            </div>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>

{{ footer }}

<!-- Autocomplete Script -->
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

<style>
  .ui-autocomplete {
    position: absolute;
    z-index: 9999 !important;
    max-height: 200px;
    overflow-y: auto;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  .ui-menu-item {
    padding: 8px 12px;
    cursor: pointer;
  }
  .ui-menu-item:hover {
    background-color: #f0f0f0;
  }
</style>

<script>
$(function () {
  $('#input-product').autocomplete({
    source: function (request, response) {
      $.ajax({
        url: 'index.php?route=catalog/product.autocomplete&user_token={{ user_token }}&filter_name=' + encodeURIComponent(request.term),
        dataType: 'json',
        success: function (json) {
          response($.map(json, function (item) {
            return { label: item.name, value: item.product_id };
          }));
        }
      });
    },
    select: function (event, ui) {
      if (!$('#module-product-' + ui.item.value).length) {
        $('#module-product').append(
          '<div id="module-product-' + ui.item.value + '">' +
          '<i class="fa-solid fa-minus-circle"></i> ' + ui.item.label +
          '<input type="hidden" name="module_baithay_product[]" value="' + ui.item.value + '" />' +
          '</div>'
        );
      }
      $('#input-product').val('');
      return false;
    },
    minLength: 1,
    delay: 500
  });

  $(document).on('click', '#module-product .fa-minus-circle', function () {
    $(this).parent().remove();
  });
});
</script>
